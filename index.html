<!doctype html>
<meta charset="utf-8">
<title>Unhinged Trivia</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- libs for backgrounds and particles -->
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
<script defer src="https://unpkg.com/vanta/dist/vanta.fog.min.js"></script>
<script defer src="https://unpkg.com/vanta/dist/vanta.waves.min.js"></script>
<script defer src="https://unpkg.com/vanta/dist/vanta.halo.min.js"></script>
<script defer src="https://unpkg.com/vanta/dist/vanta.net.min.js"></script>
<script defer src="https://cdn.jsdelivr.net/npm/tsparticles@3/tsparticles.bundle.min.js"></script>

<style>
  :root{ --bg1:#060917; --bg2:#10061a; --fg:#fff; --accent:#2dfcff; --hot:#ff2d75; }
  *{box-sizing:border-box} html,body{height:100%}
  body{
    margin:0; color:var(--fg);
    font:16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    background:linear-gradient(135deg,var(--bg1),var(--bg2));
    overflow-x:hidden;
  }

  /* layers */
  #vanta {position:fixed; inset:0; z-index:0}
  #tsparticles {position:fixed; inset:0; z-index:1; pointer-events:none}
  #flash {position:fixed; inset:0; background:#fff; opacity:0; z-index:4; pointer-events:none}
  #overlay {position:fixed; inset:0; z-index:5; pointer-events:none}

  /* app */
  #cam{position:relative; z-index:3; transform-origin:50% 35%}
  #wrap{max-width:1100px; margin:34px auto; padding:16px}
  h1{margin:0 0 12px; font-size:44px; letter-spacing:.5px; position:relative; display:inline-block; text-shadow:0 0 18px rgba(45,252,255,.25),0 0 8px rgba(255,45,117,.18)}
  .tPulse{animation:glowPulse 2s ease} .tTilt{animation:tilt .6s ease} .tHue{animation:hue 3s ease} .tFlick{animation:flicker 1s linear}
  @keyframes glowPulse{0%,100%{text-shadow:0 0 10px rgba(45,252,255,.15)}50%{text-shadow:0 0 36px rgba(45,252,255,.55)}}
  @keyframes tilt{0%{transform:rotate(0)}50%{transform:rotate(.7deg)}100%{transform:rotate(0)}}
  @keyframes hue{0%{filter:hue-rotate(0)}100%{filter:hue-rotate(24deg)}}
  @keyframes flicker{0%,19%,21%,23%,25%,54%,56%,100%{opacity:1}20%,24%,55%{opacity:.6}}

  #hud{display:flex;align-items:center;gap:10px;margin:8px 0 14px;opacity:.95}
  #bar{position:relative;height:14px;flex:1;background:#ffffff25;border-radius:999px;overflow:hidden}
  #fill{position:absolute;inset:0;width:100%;background:linear-gradient(90deg,var(--hot),var(--accent))}
  #q{font-size:30px;margin:18px 0 12px}

  .opt{display:block;width:100%;text-align:left;margin:10px 0;padding:16px 18px;border-radius:16px;border:1px solid #ffffff3a;color:var(--fg);background:#ffffff16;cursor:pointer;font-weight:800;transition:transform .06s ease,background .15s ease,border-color .15s ease}
  .opt:hover{transform:translateY(-1px);background:#ffffff1b}
  .opt.ok{background:#134323;border-color:#2fff8f;box-shadow:0 0 36px rgba(46,255,143,.35)}
  .opt.no{background:#441425;border-color:#ff5b8b;box-shadow:0 0 36px rgba(255,91,139,.34)}
  .locked .opt{pointer-events:none;opacity:.9}

  .shake{animation:shake .65s cubic-bezier(.36,.07,.19,.97)}
  @keyframes shake{
    10%{transform:translate(-10px, 5px) rotate(-0.9deg)}
    20%{transform:translate(12px, -6px) rotate(.9deg)}
    30%{transform:translate(-12px, 6px) rotate(-.9deg)}
    40%{transform:translate(9px, -5px) rotate(.7deg)}
    50%{transform:translate(-8px, 4px) rotate(-.6deg)}
    60%{transform:translate(6px, 0px) rotate(.5deg)}
    70%{transform:translate(-6px, 4px) rotate(-.4deg)}
    80%{transform:translate(5px, -4px) rotate(.3deg)}
    90%{transform:translate(-4px, 3px) rotate(-.2deg)}
  }

  /* transition overlay bits */
  .slice{position:absolute; top:0; left:-30%; width:30%; height:100%; background:linear-gradient(135deg,rgba(45,252,255,.9),rgba(255,45,117,.9)); transform:skewX(-20deg); animation:slice 420ms ease forwards}
  @keyframes slice{0%{left:-30%}100%{left:130%}}
  .ripple{position:absolute; border-radius:999px; background:radial-gradient(circle, rgba(255,255,255,.75) 0%, rgba(255,255,255,0) 60%); width:20px; height:20px; top:50%; left:50%; transform:translate(-50%,-50%); animation:ripple 420ms ease forwards}
  @keyframes ripple{0%{opacity:.9; transform:translate(-50%,-50%) scale(1)}100%{opacity:0; transform:translate(-50%,-50%) scale(40)}}

  /* table and buttons */
  #done{display:none;margin-top:22px}
  table{width:100%;border-collapse:collapse;margin-top:8px}
  th,td{padding:8px 10px;border-bottom:1px solid #ffffff22;text-align:left}
  input[type=text]{background:#ffffff14;border:1px solid #ffffff33;color:var(--fg);padding:10px;border-radius:10px}
  .btn{display:inline-block;margin:8px 6px 0 0;padding:10px 12px;border-radius:10px;border:1px solid #ffffff38;background:#ffffff18;color:var(--fg);cursor:pointer}
  .btn:hover{background:#ffffff22}
</style>

<body>
  <div id="vanta"></div>
  <div id="tsparticles"></div>
  <div id="flash"></div>
  <div id="overlay"></div>

  <div id="cam">
    <div id="wrap">
      <h1 id="title">Unhinged Trivia</h1>

      <div id="hud">
        <div>Score <b id="score">0</b></div><div>â€¢</div><div>Q <b id="idx">0</b></div>
        <div id="bar"><div id="fill"></div></div>
      </div>

      <h2 id="q">Loading...</h2>
      <div id="opts"></div>

      <div id="done">
        <h2>Done</h2>
        <p>Total <b id="final">0</b></p>
        <div>
          <input id="name" type="text" placeholder="Your name" maxlength="24">
          <button class="btn" id="saveScore">Save score</button>
          <button class="btn" id="clearLB">Clear leaderboard</button>
        </div>
        <table id="lb"><thead><tr><th>#</th><th>Name</th><th>Score</th><th>Date</th></tr></thead><tbody></tbody></table>
        <small>Leaderboard is stored locally in this browser</small>
      </div>
    </div>
  </div>

<script>
/* knobs */
const FX = { scale: 18, shake: 1.6 };

/* state */
const CSV_URL = "https://raw.githubusercontent.com/Grouchy-Lawn-Chair/TriviaTrivia/main/questions.csv";
const $ = s => document.querySelector(s);
const cam = $("#cam"), title = $("#title"), qEl = $("#q"), optsEl = $("#opts"), overlay = $("#overlay");
const idxEl = $("#idx"), scoreEl = $("#score"), finalEl = $("#final"), fill = $("#fill"), flashEl = $("#flash");
let Q = [], i = 0, score = 0, tried = new Set(), answered = false, limit = 20, left = 0, timer = 0;

/* title tiny life */
function randomTitleNudge(){ const cls=["tPulse","tTilt","tHue","tFlick"][Math.floor(Math.random()*4)]; title.classList.add(cls); setTimeout(()=>title.classList.remove(cls),1200) }
setInterval(()=>{ if(Math.random()<.8) randomTitleNudge() }, 3500);

/* utilities */
function shuffle(a){for(let j=a.length-1;j>0;j--){const k=Math.floor(Math.random()*(j+1));[a[j],a[k]]=[a[k],a[j]]}return a}
function makeSampler(n){ let bag = shuffle([...Array(n).keys()]); let idx = 0; return { next(){ if(idx>=bag.length){ bag = shuffle(bag); idx = 0 } return bag[idx++] } } }
function setLocked(on){$("#wrap").classList.toggle("locked",on); answered = on}
function flash(strength=1){ flashEl.style.opacity=String(Math.min(1,strength)); flashEl.style.transition="opacity .25s"; requestAnimationFrame(()=>{ flashEl.style.opacity="0" }) }
function camShake(ms=450,amp=15){ const t0=performance.now(), A=amp*FX.shake; function f(t){ const k=Math.max(0,1-(t-t0)/ms); const x=(Math.random()*2-1)*A*k, y=(Math.random()*2-1)*A*k, r=(Math.random()*2-1)*0.9*k; cam.style.transform=`translate(${x}px,${y}px) rotate(${r}deg)`; if(k>0) requestAnimationFrame(f); else cam.style.transform="" } requestAnimationFrame(f)}

/* audio */
let AC;
function audio(){AC=AC||new (window.AudioContext||window.webkitAudioContext)(); return AC}
function sBoom(){try{const ac=audio(); const g=ac.createGain(); g.gain.value=.18; g.connect(ac.destination); const o=ac.createOscillator(); o.type="sine"; o.frequency.setValueAtTime(120,ac.currentTime); o.frequency.exponentialRampToValueAtTime(40,ac.currentTime+.35); o.connect(g); const n=ac.createBufferSource(); const b=ac.createBuffer(1,ac.sampleRate*.4,ac.sampleRate); const ch=b.getChannelData(0); for(let i=0;i<ch.length;i++){ ch[i]=(
